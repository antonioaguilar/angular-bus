s(function(e,t){e.pubsub=t(e._,e)}(this,function(e,t,n){var i={DEFAULT_CHANNEL:"/",SYSTEM_CHANNEL:"SYS",enableSystemMessages:false,cacheKeyDelimiter:"|",autoCompactResolver:false};var r={configuration:e.extend({},i)};var c=r.configuration;var s=function(e,t){this.bus=t;this.channel=e||c.DEFAULT_CHANNEL};s.prototype.subscribe=function(){return this.bus.subscribe({channel:this.channel,topic:arguments.length===1?arguments[0].topic:arguments[0],callback:arguments.length===1?arguments[0].callback:arguments[1]})};s.prototype.publish=function(){var e={};var t;if(typeof arguments[0]==="string"){e.topic=arguments[0];e.data=arguments[1];t=arguments[2]}else{e=arguments[0];t=arguments[1]}if(typeof e!=="object"){throw new Error("The first argument to ChannelDefinition.publish should be either an envelope object or a string topic.")}e.channel=this.channel;this.bus.publish(e,t)};var a=function(e,t,i){if(arguments.length!==3){throw new Error("You must provide a channel, topic and callback when creating a SubscriptionDefinition instance.")}if(t.length===0){throw new Error("Topics cannot be empty")}this.channel=e;this.topic=t;this.callback=i;this.pipeline=[];this.cacheKeys=[];this._context=n};var u=function(){var t;return function(n){var i=false;if(typeof n==="string"){i=n===t;t=n}else{i=e.isEqual(n,t);t=e.extend({},n)}return!i}};var o=function t(){var n=[];return function t(i){var r=!e.some(n,function(t){return e.isEqual(i,t)});if(r){n.push(i)}return r}};a.prototype={catch:function(e){var t=this.callback;this.callback=function(){try{t.apply(this,arguments)}catch(t){e(t,arguments[0])}};return this},defer:function e(){return this.delay(0)},disposeAfter:function t(n){if(typeof n!=="number"||n<=0){throw new Error("The value provided to disposeAfter (maxCalls) must be a number greater than zero.")}var i=this;var r=e.after(n,e.bind(function(){i.unsubscribe()}));i.pipeline.push(function(e,t,n){n(e,t);r()});return i},distinct:function e(){return this.constraint(new o)},distinctUntilChanged:function e(){return this.constraint(new u)},invokeSubscriber:function e(t,n){if(!this.inactive){var i=this;var r=i.pipeline;var c=r.length;var s=i._context;var a=-1;var u=false;if(!c){i.callback.call(s,t,n);u=true}else{r=r.concat([i.callback]);var o=function e(t,n){a+=1;if(a<c){r[a].call(s,t,n,e)}else{i.callback.call(s,t,n);u=true}};o(t,n,0)}return u}},logError:function e(){if(console){var t;if(console.warn){t=console.warn}else{t=console.log}this.catch(t)}return this},once:function e(){return this.disposeAfter(1)},subscribe:function e(t){this.callback=t;return this},unsubscribe:function e(){if(!this.inactive){r.unsubscribe(this)}},constraint:function e(t){if(typeof t!=="function"){throw new Error("Predicate constraint must be a function")}this.pipeline.push(function(e,n,i){if(t.call(this,e,n)){i(e,n)}});return this},constraints:function t(n){var i=this;e.each(n,function(e){i.constraint(e)});return i},context:function e(t){this._context=t;return this},debounce:function t(n,i){if(typeof n!=="number"){throw new Error("Milliseconds must be a number")}this.pipeline.push(e.debounce(function(e,t,n){n(e,t)},n,!!i));return this},delay:function e(t){if(typeof t!=="number"){throw new Error("Milliseconds must be a number")}var n=this;n.pipeline.push(function(e,n,i){setTimeout(function(){i(e,n)},t)});return this},throttle:function t(n){if(typeof n!=="number"){throw new Error("Milliseconds must be a number")}var i=function(e,t,n){n(e,t)};this.pipeline.push(e.throttle(i,n));return this}};var h=c.resolver={cache:{},regex:{},enableCache:true,compare:function t(n,i,r){var s;var a;var u;var o=i+c.cacheKeyDelimiter+n;var h=this.cache[o];var f=r||{};var l=this.enableCache&&!f.resolverNoCache;if(h===true){return h}if(n.indexOf("#")===-1&&n.indexOf("*")===-1){h=i===n;if(l){this.cache[o]=h}return h}if(!(a=this.regex[n])){s="^"+e.map(n.split("."),function e(t){var n="";if(!!u){n=u!=="#"?"\\.\\b":"\\b"}if(t==="#"){n+="[\\s\\S]*"}else if(t==="*"){n+="[^.]+"}else{n+=t}u=t;return n}).join("")+"$";a=this.regex[n]=new RegExp(s)}h=a.test(i);if(l){this.cache[o]=h}return h},reset:function e(){this.cache={};this.regex={}},purge:function(t){var n=this;var i=c.cacheKeyDelimiter;var s=function(e,r){var c=r.split(i);var s=c[0];var a=c[1];if((typeof t.topic==="undefined"||t.topic===s)&&(typeof t.binding==="undefined"||t.binding===a)){delete n.cache[r]}};var a=function(e,t){var c=t.split(i);if(r.getSubscribersFor({topic:c[0]}).length===0){delete n.cache[t]}};if(typeof t==="undefined"){this.reset()}else{var u=t.compact===true?a:s;e.each(this.cache,u)}}};var f=0;var l=[];var b=0;function p(){while(l.length){r.unsubscribe(l.shift())}}function v(e,t,n){return function(i,r,c){if(i===e){c.splice(r,1)}if(c.length===0){delete n[t]}}}function d(e,t,n,i,r){var s=r&&r.headers||{};return function(t){if(c.resolver.compare(t.topic,e,s)){t.cacheKeys.push(n);if(i){i(t)}}}}function g(e,t){return{channel:c.SYSTEM_CHANNEL,topic:"subscription."+e,data:{event:"subscription."+e,channel:t.channel,topic:t.topic}}}var m=e.bind(g,this,"created");var y=e.bind(g,this,"removed");function w(t,n){if(typeof t==="function"){return t}else if(!t){return function(){return true}}else{return function(i){var r=0;var c=0;e.each(t,function(e,s){r+=1;if(s==="topic"&&n.compare(i.topic,t.topic,{resolverNoCache:true})||s==="context"&&t.context===i._context||i[s]===t[s]){c+=1}});return r===c}}}e.extend(r,{cache:{},subscriptions:{},wireTaps:[],ChannelDefinition:s,SubscriptionDefinition:a,channel:function e(t){return new s(t,this)},addWireTap:function e(t){var n=this;n.wireTaps.push(t);return function(){var e=n.wireTaps.indexOf(t);if(e!==-1){n.wireTaps.splice(e,1)}}},getSubscribersFor:function t(n){var i=[];var r=this;e.each(r.subscriptions,function(t){e.each(t,function(t){i=i.concat(e.filter(t,w(n,c.resolver)))})});return i},publish:function t(n,i){++f;n.timestamp=(new Date).toISOString();var r=n.channel=n.channel||c.DEFAULT_CHANNEL;var s=n.topic;if(this.wireTaps.length){e.each(this.wireTaps,function(e){e(n.data,n,f)})}var a=r+c.cacheKeyDelimiter+s;var u=0;var o=0;var h=this.cache[a];if(!h){var l=d(s,this.cache,a,function(e){if(e.invokeSubscriber(n.data,n)){o++}else{u++}},n);e.each(this.subscriptions[r],function(t){e.each(t,l)})}else{e.each(h,function(e){if(e.invokeSubscriber(n.data,n)){o++}else{u++}})}if(--f===0){p()}if(i){i({activated:o,skipped:u})}},subscribe:function t(n){var i=this.subscriptions;var r=new a(n.channel||c.DEFAULT_CHANNEL,n.topic,n.callback);var s=i[r.channel];var u=r.channel.length;var o;if(!s){s=i[r.channel]={}}o=i[r.channel][r.topic];if(!o){o=i[r.channel][r.topic]=[]}o.push(r);e.each(e.keys(this.cache),function(e){if(e.substr(0,u)===r.channel){d(e.split(c.cacheKeyDelimiter)[1],this.cache,e)(r)}},this);if(c.enableSystemMessages){this.publish(m(r))}return r},unsubscribe:function t(){var n=arguments.length;var i=0;var r;var s;var a;var u;for(;i<n;i++){r=arguments[i];r.inactive=true;if(f){l.push(r);return}s=this.subscriptions[r.channel];a=s&&s[r.topic];if(a){var o=a.length;u=0;while(u<o){if(a[u]===r){a.splice(u,1);break}u+=1}if(a.length===0){delete s[r.topic];if(!e.keys(s).length){delete this.subscriptions[r.channel]}}if(r.cacheKeys&&r.cacheKeys.length){var h;while(h=r.cacheKeys.pop()){e.each(this.cache[h],v(r,h,this.cache))}}if(typeof c.resolver.purge==="function"){var p=c.autoCompactResolver===true?0:typeof c.autoCompactResolver==="number"?c.autoCompactResolver-1:false;if(p>=0&&b===p){c.resolver.purge({compact:true});b=0}else if(p>=0&&b<p){b+=1}}}if(c.enableSystemMessages){this.publish(y(r))}}},reset:function e(){this.unsubscribeFor();c.resolver.reset();this.subscriptions={};this.cache={}},unsubscribeFor:function e(t){var n=[];if(this.subscriptions){n=this.getSubscribersFor(t);this.unsubscribe.apply(this,n)}}});var S=function(t,i,c,s){var a=this;var u=Object.prototype.toString.call(c)==="[object Function]"?c:function(){};var o=Object.prototype.toString.call(c)==="[object Object]"?c:s||{};var h=[];var f;var l=function(){if(o.timeout){f=setTimeout(function(){u({type:"timeout",data:e.map(h,"data")})},o.timeout)}};var b=function(){e.each(h,function(e){e.data=n})};var p=function(){var t=e.map(h,"data");if(e.every(t,e.identity)){clearTimeout(f);i.apply(this,t);if(o.once){a.dispose()}else{b();l()}}};a.dispose=function(){e.each(h,function(e){e.unsubscribe()});h=[]};e.each(t,function(e){var t=r.subscribe(e);t.data=n;t.subscribe(function(e){t.data=e;p()});h.push(t)});l()};r.when=function(e,t,n,i){return new S(e,t,n,i)};return r}));(function(){angular.module("ngBus",[]).config(["$provide",function(e){e.decorator("$rootScope",["$delegate",function(e){Object.defineProperty(e.constructor.prototype,"$event",{get:function(){var e=this;return{when:pubsub.when.bind(pubsub),channel:pubsub.publish.bind(pubsub),publish:pubsub.publish.bind(pubsub),subscribe:function(){var t=pubsub.subscribe.apply(pubsub,arguments);e.$on("$destroy",function(){t.unsubscribe()});return t},subscriptions:pubsub.subscriptions,getSubscribersFor:pubsub.getSubscribersFor.bind(pubsub),unsubscribeFor:pubsub.unsubscribeFor.bind(pubsub),addWireTap:pubsub.addWireTap.bind(pubsub),reset:pubsub.reset}},enumerable:false});return e}])}])})();